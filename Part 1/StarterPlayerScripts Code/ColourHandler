local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer

local function getPlayerColor()
	local char = localPlayer.Character
	if not char then return nil end

	local highlight = char:FindFirstChild("PairHighlight")
	if not highlight then return nil end

	local color = highlight.FillColor
	if color == Color3.fromRGB(0, 0, 255) then
		return "Blue"
	elseif color == Color3.fromRGB(255, 0, 0) then
		return "Red"
	end

	return nil
end

local function updateObbyParts()
	local char = localPlayer.Character or localPlayer.CharacterAdded:Wait()
	local isPaired = char:FindFirstChild("PairHighlight") ~= nil
	local playerColor = getPlayerColor()

	for _, part in workspace:GetDescendants() do
		if part:IsA("BasePart") and part:FindFirstChild("ColourTag") then
			local tag = part:FindFirstChild("ColourTag").Value

			if isPaired then
				if tag == playerColor then
					part.Transparency = 0
					part.CanCollide = true
				else
					part.Transparency = 1
					part.CanCollide = false
				end
			else
				part.Transparency = 1
				part.CanCollide = false
			end
		end
	end
end

localPlayer.CharacterAdded:Connect(function()
	task.wait(0.5)
	updateObbyParts()
end)

while true do
	task.wait(1)
	pcall(updateObbyParts)
end
